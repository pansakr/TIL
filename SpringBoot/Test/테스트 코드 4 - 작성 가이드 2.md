### 테스트 코드 작성 가이드 2

* Repository 게층 테스트

    - existsByEmail(), existsByPhone()

    ```java
    @DataJpaTest
    @AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
    @Import({UserQueryRepository.class, JpaConfig.class})
    @ActiveProfiles("test") // test 프로파일을 따로 쓰지 않으면 빼도 됨
    class UserQueryRepositoryTest {

        @Autowired
        private UserQueryRepository userQueryRepository;

        @Autowired
        private UserRepository userRepository;

        @Test
        @DisplayName("이메일이 존재하면 true 를 반환한다")
        void existsByEmail_true_whenUserExists() {
            // given
            UserEntity user = new UserEntity(
                    "user@test.com",
                    "encoded_pw",
                    "테스트사용자",
                    "테스트 주소",
                    "01012345678",
                    UserRole.USER,
                    UserStatus.ACTIVE
            );
            userRepository.save(user);

            // when
            boolean exists = userQueryRepository.existsByEmail("user@test.com");

            // then
            assertThat(exists).isTrue();
        }

        @Test
        @DisplayName("이메일이 존재하지 않으면 false 를 반환한다")
        void existsByEmail_false_whenUserNotExists() {
            // when
            boolean exists = userQueryRepository.existsByEmail("no-user@test.com");

            // then
            assertThat(exists).isFalse();
        }

        @Test
        @DisplayName("휴대폰 번호가 존재하면 true 를 반환한다")
        void existsByPhone_true_whenUserExists() {
            // given
            UserEntity user = new UserEntity(
                    "phone@test.com",
                    "encoded_pw",
                    "테스트사용자2",
                    "테스트 주소2",
                    "01099998888",
                    UserRole.USER,
                    UserStatus.ACTIVE
            );
            userRepository.save(user);

            // when
            boolean exists = userQueryRepository.existsByPhone("01099998888");

            // then
            assertThat(exists).isTrue();
        }

        @Test
        @DisplayName("휴대폰 번호가 존재하지 않으면 false 를 반환한다")
        void existsByPhone_false_whenUserNotExists() {
            // when
            boolean exists = userQueryRepository.existsByPhone("01000001111");

            // then
            assertThat(exists).isFalse();
        }
    }
    ```

    - @DataJpaTest

        - Spring Data JPA Repository 인터페이스를 빈으로 등록하는 테스트 설정

            - @Entity, JPA 관련 설정

            - 서비스, 컨트롤러 같은 설정은 로드하지 않음

            - 각 테스트 메서드는 트랜잭션 안에서 실행되고, 끝나면 자동 롤백됨

    - @Import

        - 특정 클래스를 스프링 빈으로 강제 등록시키는 설정

            - UserQueryRepository 는 Data Jpa Repository 인터페이스가 아니기 때문에 빈으로 등록이 안됨

            - JPAQueryFactory 를 빈으로 등록하는 JpaConfig 도 빈으로 등록이 안됨

            - 둘 다 테스트에 필요하기 때문에 @Import 를 사용해 수동 등록

    - @AutoConfigureTestDatabase

        - 테스트에 사용하는 DB 자동설정(기본값 H2 DB)

        - 테스트에 실제 DB를 사용하고 싶다면 (replace = AutoConfigureTestDatabase.Replace.NONE) 사용

    - @ActiveProfiles("test")

        - application-test.yml 을 사용하겠다는 의미
