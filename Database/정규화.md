### 무결성

* 데이터가 잘못된 상태로 저장되지 않도록 보장하는 것

* 무결성의 속성 (데이터 품질이 지향해야 할 목표)

  - 정합성 : 회원의 나이는 - 로 저장되면 안됨
 
  - 일관성 : 1번 회원의 이름이 어떤 테이블에서 '하늘' 일 때, 다른 테이블에서 '바다' 로 저장되면 안됨
 
  - 정확성 : 주문이 있는데, 실제로 존재하지 않는 상품 ID를 참조하면 안됨
 
* 무결성의 종류 (목표를 달성하기 위한 제약 조건)

  - 개체 무결성 (PRIMARY KEY, UNIQUE, NOT NULL)
 
    - 기본키는 NULL 이 될 수 없고, 중복될 수 없음
   
    - 회원 테이블에서 회원 번호가 NULL 이거나, 1번 회원이 두 번 나오면 무결성 깨짐
   
  - 참조 무결성 (FOREIGN KEY)
 
    - 외래키는 반드시 실제로 존재하는 기본키 값만 참조해야 함
   
    - 주문 테이블에서 상품 ID = 10 을 가리키고 있는데, 상품 테이블에 10번 상품이 없으면 무결성 깨짐
   
  - 도메인 무결성 (CHECK, DEFAULT, 컬럼 데이터 타입)
 
    - 컬럼 값은 정해진 도메인(범위/타입) 안에 있어야 함
   
    - 나이는 음수가 될 수 없고, 이메일은 특정 형식이어야 함
   
    - 제약조건으로 보장할 수 있음
   
  - 사용자 정의 무결성 (애플리케이션 로직)
 
    - 특정 비즈니스 규칙에 따른 무결성
   
    - 한 사람은 특정 상품을 한 달에 10개 까지만 구매할 수 있다    

### 정규화

* 데이터의 중복을 최소화하고 무결성을 높이기 위해 테이블을 쪼개고 관계를 정리하는 과정

  - 데이터의 삽입/수정/삭제 시 데이터 불일치 방지
 
* 정규화는 5단계까지 있고, 아래 단계로 갈수록 세분화되어 테이블 개수가 많아진다

  - 지나치게 정규화하면 테이블이 너무 잘게 쪼개져서 조회할 대 조인이 과도하게 발생하므로 성능이 저하된다
 
  - 보통 3정규형 또는 BCNF 정도까지만 적용한다

### 이상 현상

* 테이블을 잘못 설계하여 데이터를 삽입/삭제/수정 할 때 발생하는 논리적 오류

* 갱신 이상

  - 중복된 데이터 중 일부만 수정되어 데이터의 불일치가 발생하는 현상

  ```
  과목 테이블
  +---------+---------+----------+
  | 과목ID  | 과목명  | 교수명   | 교수학과  |
  +---------+---------+----------+----------+
  | 1       | 수학    | 김교수   | 수학과   |
  | 2       | 통계    | 김교수   | 수학과   |
  | 3       | 물리    | 박교수   | 물리학과 |
  ```

  - '김교수' 는 수학과이고 수학, 통계 과목을 담당하고 있음
 
  - 이때 '김교수' 가 통계학과로 옮겼다면 '김교수' 가 들어간 모든 행을 수정해야 함
 
  - 만약 과목명이 '수학' 인 행은 수정했는데, '통계' 인 행은 수정하지 않았다면 같은 사람인데 어떤 행은 '수학과', 어떤 행은 '통계학과' 로 데이터 불일치 발생
   
* 삽입 이상

  - 자료를 삽입할 때 의도하지 않은 자료까지 삽입해야 테이블에 삽입이 가능한 현상
 
  ```
  과목 테이블
  +---------+---------+----------+----------+
  | 과목ID  | 과목명  | 교수명   | 교수학과 |
  +---------+---------+----------+----------+
  | 1       | 수학    | 김교수   | 수학과  |
  | 2       | 통계    | 이교수   | 통계학과|
  ```

  - '박교수(물리학과)' 를 추가하려 하지만, 아직 담당 과목이 없음
 
  - 그러나 테이블 구조상 과목명은 NOT NULL 이라 반드시 입력해야 함
 
  - 그 결과 과목명에 억지로 NULL 같은 가짜 데이터를 넣어야 데이터 추가가 가능하게 됨
 
* 삭제 이상

  - 어떤 정보를 삭제하면 의도하지 않은 다른 정보까지 삭제되어 버리는 현상
 
  ```
  과목 테이블
  +---------+---------+----------+----------+
  | 과목ID  | 과목명  | 교수명   | 교수학과 |
  +---------+---------+----------+----------+
  | 1       | 수학    | 김교수   | 수학과  |
  | 2       | 통계    | 이교수   | 수학과  |
  ```

  - 통계 과목이 폐강되서 과목 ID = 2 인 행을 삭제함
 
  - 그 결과 '이교수' 라는 교수 정보도 같이 사라짐
 
  - 과목 데이터 삭제와 별개로 교수 정보는 존재해야 하지만, 함께 삭제되는 문제 발생
 
* 이런 이상 현상들은 정규화를 통해 해결할 수 있음

  - 교수 테이블(교수ID, 이름, 학과), 과목 테이블(과목ID, 과목명, 교수ID FK) 로 분리하면 문제가 사라짐


#### 제1 정규형 (1NK)

* 테이블의 컬럼이 하나의 값만 갖도록 테이블을 분해하는 것


#### 제2 정규형 (2NK)

* 제1 정규화를 진행한 테이블에 대해 완전 함수 종속을 만들도록 테이블을 분해하는 것.

* 완전 함수 종속이란 기본키의 부분집합이 결정자가 되어선 안된다는 것을 의미한다.

* 즉 테이블의 컬럼들이 pk에만 종속되도록 하는것이다.

* 한 테이블에 학생번호, 과목 컬럼이 기본키이고, 성적, 지도교수 총 4개의 컬럼이 있을때 학생번호, 과목 컬럼으로 즉 기본키로 성적을 알수 있다.

* 하지만 기본키의 일부분, 과목 컬럼만으로 지도교수 컬럼을 알 수 있기 때문에 이 부분을 분해해주어야 한다.

* 학생번호, 과목, 성적 테이블 - 성적 값을 알기 위해선 학생번호,과목 컬럼의 pk가 필요하다.

* 과목, 지도교수 테이블 - 지도교수를 알기 위해선 과목컬럼의 pk가 필요하다.  

* 2개의 테이블로 나누면 제 2정규화를 만족한다.   


#### 제3 정규형 (3NK)

* 2 정규형을 만족하고, 기본키를 제외한 속성들 간의 이행 종속성이 없어야 한다.

* 테이블에 a,b,c 컬럼이 있을때 a->b, b->c 일때 a-c 가 성립하면 이행 종속이라고 한다.

* 한 테이블에 아이디, 등급, 할인율 컬럼이 있을때, 아이디를 알면 등급을 알수 있고, 등급을 알면 할일율을 알 수 있다.

* 따라서 아이디를 알면 할인율을 알 수 있다. 이행 종속성이 존재하므로 3정규형을 만족하지 않는다.

* 3정규형을 만족하기 위해서는 아이디, 등급 테이블과 등급, 할인율의 두개의 테이블로 나누어야 한다.


#### 보이스-코드 정규형 (BCNF : Boyce-Codd Normal Form)

* 3 정규형을 만족하고, 모든 결정자가 후보키 집합에 속해야 한다.

* 한 테이블에 학생번호, 과목, 지도교수 컬럼이 있고, 학생번호, 과목이 기본키 일때 기본키로 지도교수를 알 수 있지만

* 지도교수로 과목 칼럼을 알 수 있다.

* 이처럼 후보키 집합이 아닌 칼럼이 결정자가 되어버린 상황을 BCNF를 만족하지 않는다고 한다.

* 학생번호, 지도교수 테이블과 지도교수, 과목의 테이블로 나누면 BCNF를 만족한다. 

#### 제4 정규형 (4NK)

#### 제5 정규형 (5NK)
