### L4 tcp,udp

* tcp에만 연결 개념이 있다.

* UDP는 비연결지향성 통신이다.

* tcp의 전송 단위는 세그먼트, udp는 데이터그램이다.

* 연결과정은 프로세스가 소켓(디바이스 파일)을 생성 후 오픈 하고 운영체제가 소켓에 tcp포트번호를 부여한다.

* 소켓을 오픈한 프로세스는 자신의 식별자인 프로세스아이디(Pid)를 가지고 있다. 

* 부여되는 tcp 포트번호는 가지고 있는 포트번호 중 아무거나 열린다.

* 서버측에 요청하려는 포트번호와 동일한 포트번호가 열려서 연결 대기상태로 있어야 통신이 가능하다.

* 서버와 통신시 ip주소에 더해 포트번호도 반드시 알고있어야 한다.

* 3Way Handshaking으로 서버과 연결하고 4Way Handshaking으로 연결을 종료한다.

* web통신 기본 포트번호는 80이다.

* 연결 종료시 소켓이 회수된다.


### 3Way HandShaking

* 클라이언트와 서버가 통신을 하기 전 연결을 먼저 해야하고 이때 사용되는 방법이다.

* 컨트롤 비트가 사용되고 syn과 ack이 사용된다.

* 클라이언트는 서버에게 접속을 요청하는 syn을 보낸다.

* 서버는 syn요청을 받고 클라이언트에게 요청을 수락한다는 ack와 syn이 설정된 패킷을 보낸다.

* 클라이언트는 서버에게 다시 ack를 보낸다


### 4Way HandShaking

* 모든 통신이 끝나고 연결을 종료할때 사용하는 방법

* 클라이언트는 서버에게 연결을 종료하겠다는 fin을 보낸다.

* 서버는 클라이언트에게 ack를 보내고 통신이 끝나면 fin을 보낸다.

* 클라이언트는 확인했다는 의미로 서버에세 ack를 보낸다.

* 이때 서버가 fin을 보내기 전에 보냈던 패킷이 fin보다 늦게 도착할 수 있고 그럴때 클라이언트가 ack를 보내면

* 서버가 보낸 패킷은 클라이언트가 받을 수 없게된다.

* 그래서 클라이언트는 서버로부터 fin요청을 받더라도 일정시간동안 소켓을 닫지 않고 혹시 모를 패킷을 기다린다.

* 이렇게 잉여패킷을 기다리는 상태를 Time_Wait라고 한다.
